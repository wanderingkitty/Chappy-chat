# Chappy-chat API

This is a **Chat API** build with  **MERN stack** (MongoDB, Express, React, Node.js) and icludes authentication with **JWT(JSON Web Tokens)** and validation using **Joi**. Chappy-chat is application where users can send and recieve messages in channels or directly to other users(DMs). The API provides endpoints for user authentication, managing channels, and sending messages in both open and locked channels. The application allows for guest access to open channels and secured communication for logged-in users.

Documented with [https://writer.mintlify.com/](Mintlify Document Writer)

## Table of contents

-  [Features](#features)
-  [Tech Stack](#tech-stack)
-  [Installation](#installation)
-  [Database model](#database-model)
-  [API Endpoints](#api-endpoints)
-  [Common Error Responses](#common-error-responses)

## Features:

-   **CRUD Operations**: Create, Read, messages,channels and Create, Delete - users.
-   **Validation**: Validates product data using `Joi`.
-   **REST API**: Follows RESTful standards for better scalability and maintainability.

## Tech Stack

-   **MongoDB** (to be integrated for data persistence)
-   **Express.js** – Web framework for Node.js.
-   **Node.js** – JavaScript runtime environment.
-   **React** - A JavaScript library for building interactive user interfaces with a component-based architecture. In this project, it's used to create a real-time chat application.

## Installation

Clone the repository:

```bash
git clone https://github.com/wanderingkitty/Chappy-chat.git
cd CHAPPY-CHAT
```
Install dependencies:

```bash
npm install
```

Make sure you have an .env file in your project root:

```
CONNECTION_STRING=mongodb+srv://alinaericson95:busia123@wanderingkitty.jvb7s.mongodb.net/
PORT=1408
MONGODB_DB_NAME=Chappy-chat

```

Replace `<userName> and <password> with your MongoDb username and password.`

Start the development server:

```bash
 npm run backend
 ```

 The server will be live on `http://localhost:1408` (or your port in .env)
Check package.json for other scripts, such as clean, build and so on.


### Database-model
### User model 

| Property | Data Type | Description |
| --- | --- | --- |
| userId | string | Unique ID for the user (generated by database). |
| name | string | The user's name or username. |
| password | string | Hashed password for authentication. |
| isGuest | boolean | Indicates whether the user is a guest or logged-in. |

### Message model 

| Property | Data Type | Description |
| --- | --- | --- |
| messageId | string | Unique ID for each message. | 
| senderId | string | ID for the user who sent the message. |
| recipientId| ObjectId | ID for the user who receives the message.
| channelId | string | ID for the channel where the message was send. |
| content | string | The content of the message (text, link, or media). |
| isPrivate | boolean | Indicates whether the message is private (DM) or was sent in a channel. |
| sentAt | Date | Indicates the time the  message was sent. |

### Channel model

| Property | Data Type | Description |
| --- | --- | --- |
| name | string | The name of the chanel. |
| isPrivate | boolean | Indicates whether the channel is locked or open. |
| members | ObjectId | List of users which are included to the channel. |
| parentChannel? | string | Optional reference to the parent channel name. Used for subchannel hierarchy (e.g., "Coding" as parent for programming language specific channels). |


### Private chat model

| Property | Data Type | Description |
| --- | --- | --- |
| isPrivate | boolean | Indicates whether the chat is locked or open. |
| recipientName | string | The name for the user who receives the message. |

## API Endpoints

### Login User

`POST /login`

#### Description
Authenticates a user and returns a JWT token for subsequent requests.

#### Request Body
```json
{
  "name": "string",
  "password": "string"
}
```

### GET users

`GET /users`

#### Description
Returns a list of all users available for chat interactions.

#### Success response
- **Status:** 200 OK
- **Body:**
```json
[
  {
    "_id": "string",
    "name": "string"
  }
]
```

### GET channels

`GET /channels`

#### Description 
Returns a list of all channels, including both open and private channels.

#### Success response
- **Status:** 200 OK
- **Body:**
```json
[
  {
    "_id": "string",
    "name": "string",
    "isPrivate": "boolean",
    "parentChannel": "string"
  }
]
```

### POST channels

`POST /channels`

#### Description 
Creates a new channel. Only authorized users can create channels.

#### Request Body
```json
{
 "name": "string",
 "members": "string[]",
 "parentChannel": "string",
 "isPrivate": "boolean"
}
```

### GET channel messages

`Get /messages/:channelId`

#### Description
Returns all messages for a specific channel.

### Success response
- **Status:** 200 OK
- **Body:**
```json
[
 {
   "_id": "string",
   "senderId": "string",
   "senderName": "string",
   "content": "string",
   "channelId": "string",
   "createdAt": "Date"
 }
]
```

### Send channel message

`POST /messages`

#### Description
Sends a new mesage to selected channel.

#### Request Body
```json
{
  "content": "string",
  "channelId": "string"
}
```

### GET private chats

#### Description
Returns all private chats for authenticated user.

### Success response
- **Status:** 200 OK
- **Body:**
```json
[
  {
    "_id": "string",
    "participants": "string[]",
    "recipientName": "string",
    "senderName": "string",
    "lastMessage": {
      "content": "string",
      "createdAt": "Date"
    }
  }
]
```

### Create private chat

#### Description 
Creates a new private chat with another user from users-list.

#### Request body
```json
{
  "recipientId": "string",
  "recipientName": "string"
}
```
### Success response 
- **Status:** 201 Created
- **Body:**
```json
{
  "_id": "string",
  "participants": "string[]",
  "recipientName": "string",
  "senderName": "string"
}
```

### GET private chat messages

#### Description
Retuens all messages from a specific private chat.

### Success response
- **Status:** 200 OK
- **Body:**
```json
[
  {
    "_id": "string",
    "senderId": "string",
    "senderName": "string",
    "recipientId": "string",
    "content": "string",
    "createdAt": "Date"
  }
]
```

### Send private message

#### Description
Sends a private message to another user.

### Request body
```json
{
  "content": "string",
  "recipientId": "string",
  "recipientName": "string"
}
```
### Success response
- **Status:** 201 Created
- **Body:**
```json
{
  "message": "Message sent successfully",
  "messageId": "string"
}
```

### Common Error Responses
- 400 Bad Request (validation errors)
- 401 Unauthorized (authentication required)
- 403 Forbidden (insufficient permissions)
- 500 Internal Server Error
